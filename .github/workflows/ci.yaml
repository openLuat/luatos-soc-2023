name: Github Actions
run-name: GoGoGo üöÄ
on: [push]

jobs:
  EC7xx:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        csdk_project:
          #- download_play_mp3
          - example
          - example_adc
          - example_audio
          - example_camera
          - example_cjson
          - example_crypto
          - example_flash
          - example_fs
          - example_fskv
          - example_gpio
          - example_i2c
          - example_iconv
          - example_luatos_mqtt
          - example_luatos_socket
          - example_mobile
          - example_pm
          - example_rndis
          - example_rtc
          - example_uart
          - example_lbsLoc
          - example_gnss
        csdk_chip:
          - ec718p
          - ec718s
          - ec716s
    steps:
      - name: ÂàùÂßãÂåñÂ∑•ÂÖ∑Èìæ
        run: |
          sudo add-apt-repository ppa:xmake-io/xmake -y
          sudo apt update -y
          sudo apt-get update -y && sudo apt-get install -y gcc make g++ wget curl xmake p7zip-full
          sudo dpkg --add-architecture i386 && sudo apt update
          sudo apt-get install -y lib32z1 libc6:i386 libgcc1:i386 libstdc++5:i386 libstdc++6:i386
      - name: ÂÖãÈöÜ LuatOS ‰ª£Á†ÅÂ∫ì
        uses: actions/checkout@v4
        with:
          repository: "https://github.com/openLuat/LuatOS.git"
          path: "LuatOS"
      - name: ÂÖãÈöÜ ec7xx-csdk ‰ª£Á†ÅÂ∫ì
        uses: actions/checkout@v4
        with:
          path: "luatos-soc-2023"
      - name: ‰∏ãËΩΩGcc
        run: |
          mkdir tools
          wget -q -O tools/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2 https://github.com/wendal/xmake-docker/releases/download/dev-gcc/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
          cd tools && tar xf gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
      - name: ÊûÑÂª∫ÊåáÂÆöÈ°πÁõÆ
        run: |
          export GCC_PATH=`pwd`/tools/gcc-arm-none-eabi-10-2020-q4-major
          cd luatos-soc-2023
          xmake -y --root
        env:
          PROJECT_NAME: ${{ matrix.csdk_project }}
          CHIP_TARGET: ${{ matrix.csdk_chip }}
