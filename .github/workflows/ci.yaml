name: Github Actions
run-name: GoGoGo ğŸš€
on: [push]

jobs:
  EC7xx:
    runs-on: ubuntu-latest
    strategy:    
      matrix:
        csdk_project: ["example", "example_adc", "example_fskv", "example_gpio", "example_uart", "example_rndis", "example_rtc", "example_luatos_socket", "example_luatos_mqtt", "example_crypto"]
        csdk_chip: ["ec718p", "ec718s", "ec716s"]
    steps:
      - name: åˆå§‹åŒ–å·¥å…·é“¾
        run: |
          sudo dpkg --add-architecture i386 && sudo apt update
          sudo apt-get install gcc g++ make curl wget p7zip-full
          sudo apt-get install -y lib32z1 libc6:i386 libgcc1:i386 libstdc++5:i386 libstdc++6:i386 
      - name: å®‰è£… xmake
        run:  curl -fsSL https://xmake.io/shget.text | bash
      - name: å…‹éš† LuatOS ä»£ç åº“
        run:  git clone --depth=1 https://github.com/openLuat/LuatOS.git
      - name: å…‹éš† ec7xx-csdk ä»£ç åº“
        run:  git clone --depth=1 https://github.com/openLuat/luatos-soc-2023.git
      - name: ä¸‹è½½Gcc
        run: |
          mkdir tools
          wget -q -O tools/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2 https://github.com/wendal/xmake-docker/releases/download/dev-gcc/gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
          cd tools && tar xf gcc-arm-none-eabi-10-2020-q4-major-x86_64-linux.tar.bz2
      - name: æ„å»ºæŒ‡å®šé¡¹ç›®
        run: |
          source ~/.xmake/profile
          export GCC_PATH=`pwd`/tools/gcc-arm-none-eabi-10-2020-q4-major
          cd luatos-soc-2023
          xmake -y --root
        env:
          PROJECT_NAME: ${{ matrix.csdk_project }}
          CHIP_TARGET: ${{ matrix.csdk_chip }}
